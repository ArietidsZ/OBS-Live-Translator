<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OBS Live Translator</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div class="overlay-container">
        <!-- Features Badge -->
        <div class="features-badge">
            <div class="features-icon">‚ö°</div>
            <div class="features-text">
                <div class="features-title">LIVE TRANSLATE</div>
                <div class="features-subtitle">Real-time</div>
            </div>
        </div>

        <!-- Performance Metrics -->
        <div class="performance-display">
            <div class="metric">
                <span class="metric-value" id="latency-display">--</span>
                <span class="metric-unit">ms</span>
            </div>
            <div class="metric">
                <span class="metric-value" id="accuracy-display">--</span>
                <span class="metric-unit">%</span>
            </div>
        </div>

        <!-- Main Caption Container -->
        <div class="caption-container">
            <!-- Language Indicator -->
            <div class="language-indicator" id="language-indicator">
                <div class="language-icon">üåê</div>
                <div class="language-text">Auto-detect</div>
            </div>

            <!-- Original Text -->
            <div id="original-text" class="original-text">
                <div class="text-label">Original</div>
                <div class="text-content"></div>
                <div class="language-badge" id="source-lang">JA</div>
            </div>

            <!-- Translation Arrow -->
            <div class="translation-arrow">
                <div class="arrow-icon">‚ö°</div>
                <div class="processing-indicator" id="processing-indicator">
                    <div class="processing-text">Processing...</div>
                    <div class="processing-bar">
                        <div class="processing-fill"></div>
                    </div>
                </div>
            </div>

            <!-- Translated Text -->
            <div id="translated-text" class="translated-text">
                <div class="text-label">Translation</div>
                <div class="text-content"></div>
                <div class="language-badge" id="target-lang">ZH</div>
            </div>

            <!-- Translation Features -->
            <div class="translation-features" id="translation-features">
                <div class="feature-badge speed" title="High Speed">‚ö°</div>
                <div class="feature-badge accuracy" title="High Accuracy">üéØ</div>
                <div class="feature-badge multilang" title="Multi-language">üåç</div>
                <div class="feature-badge cache" title="Smart Cache">üíæ</div>
            </div>
        </div>

        <!-- Branding -->
        <div class="branding-footer">
            <div class="app-name">OBS Live Translator</div>
            <div class="version">v2.0</div>
            <div class="tech-stack">Rust + CUDA</div>
        </div>

        <!-- Status Container -->
        <div class="status-container">
            <div id="connection-status" class="connection-status">
                <div class="status-indicator"></div>
                <span class="status-text">Connected</span>
            </div>
            <div class="fps-counter" id="fps-counter">Testing</div>
        </div>

        <!-- Status Indicator -->
        <div class="status-mode" id="status-mode">
            <div class="status-text">üü† DEVELOPMENT MODE</div>
            <div class="status-subtitle">System in testing phase</div>
        </div>
    </div>

    <!-- Enhanced JavaScript -->
    <script src="script.js"></script>
    <script>
        // Streaming overlay enhancements
        class StreamingOverlay {
            constructor() {
                this.initializeStreamingMode();
                this.startPerformanceMonitoring();
                this.setupDemoSequence();
            }

            initializeStreamingMode() {
                // Show status indicator
                setTimeout(() => {
                    document.getElementById('status-mode').style.display = 'block';
                    setTimeout(() => {
                        document.getElementById('status-mode').style.opacity = '1';
                    }, 100);
                }, 1000);

                // Hide status indicator after 5 seconds
                setTimeout(() => {
                    const statusMode = document.getElementById('status-mode');
                    statusMode.style.opacity = '0';
                    setTimeout(() => {
                        statusMode.style.display = 'none';
                    }, 500);
                }, 6000);
            }

            startPerformanceMonitoring() {
                // Set initial testing state
                document.getElementById('latency-display').textContent = '--';
                document.getElementById('accuracy-display').textContent = '--';
                document.getElementById('fps-counter').textContent = 'Testing';
                
                // Show testing status
                setInterval(() => {
                    const statusMode = document.getElementById('status-mode');
                    if (statusMode) {
                        statusMode.style.display = 'block';
                        statusMode.style.opacity = '0.8';
                    }
                }, 5000);
            }

            setupDemoSequence() {
                // Auto-demo sequence for streaming
                const testingMessages = [
                    {
                        original: "Audio input testing...",
                        translated: "Waiting for speech recognition",
                        language: "üé§ Testing",
                        features: []
                    },
                    {
                        original: "Translation engine loading...",
                        translated: "Models initializing",
                        language: "üîÑ Loading",
                        features: []
                    },
                    {
                        original: "GPU acceleration pending...",
                        translated: "CUDA setup in progress", 
                        language: "üöÄ Setup",
                        features: []
                    },
                    {
                        original: "Ready for testing",
                        translated: "System standby",
                        language: "‚úÖ Ready",
                        features: []
                    }
                ];

                let currentTest = 0;
                
                // Show testing status every 15 seconds
                setInterval(() => {
                    if (window.captionOverlay) {
                        const test = testingMessages[currentTest];
                        
                        // Update language indicator
                        this.updateLanguage(test.language);
                        
                        // Clear features during testing
                        this.highlightFeatures([]);
                        
                        // Display testing message
                        window.captionOverlay.displayCaption({
                            original: test.original,
                            translated: test.translated,
                            timestamp: Date.now()
                        });
                        
                        currentTest = (currentTest + 1) % testingMessages.length;
                    }
                }, 15000);
            }

            updateLanguage(languageText) {
                const indicator = document.getElementById('language-indicator');
                const [flag, code] = languageText.split(' ');
                indicator.querySelector('.language-icon').textContent = flag;
                indicator.querySelector('.language-text').textContent = code;
            }

            highlightFeatures(features) {
                // Reset all features
                document.querySelectorAll('.feature-badge').forEach(badge => {
                    badge.classList.remove('active');
                });
                
                // Highlight active features  
                features.forEach(feature => {
                    const badge = document.querySelector(`.feature-badge.${feature}`);
                    if (badge) {
                        badge.classList.add('active');
                    }
                });
            }
        }

        // Initialize streaming overlay when ready
        document.addEventListener('DOMContentLoaded', () => {
            new StreamingOverlay();
        });
    </script>
</body>
</html>